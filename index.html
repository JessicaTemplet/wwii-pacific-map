<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WWII Pacific Events Map</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body { margin:0; font-family: sans-serif; }
    #map { height: 90vh; width: 100%; }
    header { padding: 10px; text-align: center; background: #f8f9fa; font-size: 20px; font-weight: bold; }
    .legend { background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); font-size: 12px; }
    .legend div { margin-bottom: 4px; }
    .marker-number { 
      background: #1F6FEB; color: #fff; border-radius: 50%; width: 24px; height: 24px; 
      display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;
      border: 2px solid #fff;
    }
    .marker-japan { background: #D0021B; }
  </style>
</head>
<body>
  <header>WWII Pacific Theater Events</header>
  <div id="map"></div>

  <script>
    // ---------------- CSV DATA ----------------
    const csvData = `id,name,start_date,end_date,lat,lon,side_offensive,tooltip_html
1,Mukden Incident,1931-09-18,,41.805,123.431,Japan,"Japanese forces stage false flag attack on railway to justify Manchuria invasion"
4,Pearl Harbor,1941-12-07,,21.3099,-157.8581,Japan,"Surprise attack on US Pacific Fleet kills 2400+ and brings America into WWII"
14,Doolittle Raid,1942-04-18,,35.676,139.650,USA,"First US air attack on Japanese home islands boosts American morale"
17,Midway,1942-06-04,1942-06-07,28.201,177.378,USA,"Decisive US victory sinks four Japanese carriers and turns tide in Pacific"
18,Guadalcanal,1942-08-07,1943-02-09,-9.645,160.156,USA,"Six-month campaign establishes first major Allied offensive victory in Pacific"
29,Iwo Jima,1945-02-19,1945-03-26,24.785,141.322,USA,"Bloodiest Pacific battle costs 36000 US casualties to secure strategic airfield"
35,Hiroshima,1945-08-06,,34.396,132.459,USA,"First atomic weapon used in warfare destroys city and kills 80000+ instantly"
36,Nagasaki,1945-08-09,,32.744,129.874,USA,"Second atomic weapon forces Japan's surrender decision; 70000+ killed immediately"
38,Surrender Signing,1945-09-02,,35.454,139.638,USA,"Formal Japanese surrender signed aboard USS Missouri in Tokyo Bay ends WWII"
`;

    // ---------------- INIT MAP ----------------
    const map = L.map('map').setView([20,150],3);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // ---------------- PARSE CSV AND ADD MARKERS ----------------
    const parsed = Papa.parse(csvData, { header:true, skipEmptyLines:true });
    const markers = [];
    parsed.data.forEach((row, idx) => {
      const lat = parseFloat(row.lat);
      const lon = parseFloat(row.lon);
      if(isNaN(lat) || isNaN(lon)) return;

      // Numbered marker
      const divIcon = L.divIcon({
        html: `<div class="marker-number ${row.side_offensive==="Japan"?"marker-japan":""}">${row.id}</div>`,
        className: 'custom-div-icon',
        iconSize: [24,24],
        iconAnchor: [12,12]
      });

      const marker = L.marker([lat, lon], { icon: divIcon })
        .bindPopup(`<strong>${row.name}</strong><br>${row.tooltip_html}<br><em>${row.start_date || ''}</em>`)
        .addTo(map);

      markers.push(marker);
    });

    // Fit map bounds to all markers
    if(markers.length>0){
      const group = L.featureGroup(markers);
      map.fitBounds(group.getBounds().pad(0.2));
    }

    // ---------------- LEGEND ----------------
    const legend = L.control({position:'bottomright'});
    legend.onAdd = function(map){
      const div = L.DomUtil.create('div','legend');
      div.innerHTML = `
        <div><strong>Legend</strong></div>
        <div><span style="display:inline-block;width:12px;height:12px;background:#D0021B;margin-right:5px;"></span>Japanese offensive</div>
        <div><span style="display:inline-block;width:12px;height:12px;background:#1F6FEB;margin-right:5px;"></span>US/Allied offensive</div>
      `;
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
